local portals = {
	--Carlin
	[9069] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10017}, --ice
	[9070] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10017}, --earth
	[9071] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10017}, --fire
	[9072] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10017}, --electric

	--Thais
	[9073] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10018}, --ice
	[9074] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10018}, --earth
	[9075] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10018}, --fire
	[9076] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10018}, --electric

	--Venore
	[9077] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10019}, --ice
	[9078] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10019}, --earth
	[9079] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10019}, --fire
	[9080] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10019}, --electric

	--Ab'Dendriel
	[9081] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10020}, --ice
	[9082] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10020}, --earth
	[9083] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10020}, --fire
	[9084] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10020}, --electric

	--Kazodron
	[9085] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10021 }, --ice
	[9086] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10021}, --earth
	[9087] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10021}, --fire
	[9088] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10021}, --electric

	--Darashia
	[9089] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10022}, --ice
	[9090] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10022}, --earth
	[9091] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10022}, --fire
	[9092] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10022}, --electric

	--Ankrahmun
	[9093] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10023}, --ice
	[9094] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10023}, --earth
	[9095] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10023}, --fire
	[9096] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10023}, --electric

	--Edron
	[9097] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10024}, --ice
	[9098] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10024}, --earth
	[9099] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10024}, --fire
	[9100] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10024}, --electric

	--Liberty Bay
	[9101] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10025}, --ice
	[9102] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10025}, --earth
	[9103] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10025}, --fire
	[9104] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10025}, --electric

	--Port Hope
	[9105] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10026}, --ice
	[9106] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10026}, --earth
	[9107] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10026}, --fire
	[9108] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10026}, --electric

	--Svargrond
	[9109] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10027}, --ice
	[9110] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10027}, --earth
	[9111] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10027}, --fire
	[9112] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10027}, --electric

	--Yalahari
	[9113] = {position = Position(32192, 31419, 2), vocation = VOCATION_DRUID, storage = 10028}, --ice
	[9114] = {position = Position(32972, 32227, 7), vocation = VOCATION_DRUID, storage = 10028}, --earth
	[9115] = {position = Position(32911, 32336, 15), vocation = VOCATION_SORCERER, storage = 10028}, --fire
	[9116] = {position = Position(33059, 32716, 5), vocation = VOCATION_SORCERER, storage = 10028} --electric
}

local shrinesPortal = MoveEvent()

function shrinesPortal.onStepIn(creature, item, position, fromPosition)
	local player = creature:getPlayer()
	if not player then
		return true
	end

	local portal = portals[item.uid]
	if not portal or player:getVocation():getBase():getId() ~= portal.vocation or player:getLevel() < 30 then
		player:teleportTo(fromPosition, true)
		player:getPosition():sendMagicEffect(CONST_ME_TELEPORT)
		player:say('Only ' .. (portal.vocation == 1 and 'Sorcerers' or 'Druids') .. ' of level 30 or higher may enter this portal.', TALKTYPE_MONSTER_SAY)
		return true
	end

	player:teleportTo(portal.position)
	player:getPosition():sendMagicEffect(CONST_ME_TELEPORT)
	player:setStorageValue(portal.storage, 1)
	return true
end

shrinesPortal:type("stepin")

for index, value in pairs(portals) do
	shrinesPortal:uid(index)
end

shrinesPortal:register()

local config = {
	{storageKey = 10017, teleportPosition = Position(32360, 31781, 9)},
	{storageKey = 10018, teleportPosition = Position(32369, 32242, 6)},
	{storageKey = 10019, teleportPosition = Position(32958, 32077, 5)},
	{storageKey = 10020, teleportPosition = Position(32681, 31686, 2)},
	{storageKey = 10021, teleportPosition = Position(32646, 31925, 11)},
	{storageKey = 10022, teleportPosition = Position(33230, 32392, 5)},
	{storageKey = 10023, teleportPosition = Position(33130, 32815, 4)},
	{storageKey = 10024, teleportPosition = Position(33266, 31835, 9)},
	{storageKey = 10025, teleportPosition = Position(32337, 32837, 8)},
	{storageKey = 10026, teleportPosition = Position(32628, 32743, 4)},
	{storageKey = 10027, teleportPosition = Position(32213, 31132, 8)},
	{storageKey = 10028, teleportPosition = Position(32786, 31245, 5)}
}

local shrinesPortalOut = MoveEvent()

function shrinesPortalOut.onStepIn(creature, item, position, fromPosition)
	local player = creature:getPlayer()
	if not player then
		return
	end

	for i = 1, #config do
		local table = config[i]
		if player:getStorageValue(table.storageKey) >= 1 then
			player:teleportTo(table.teleportPosition)
			table.teleportPosition:sendMagicEffect(CONST_ME_TELEPORT)
			player:setStorageValue(table.storageKey, 0)
			return true
		end
	end

	player:teleportTo(player:getTown():getTemplePosition())
	player:getPosition():sendMagicEffect(CONST_ME_TELEPORT)
	return true
end

shrinesPortalOut:type("stepin")
shrinesPortalOut:aid(9117)
shrinesPortalOut:register()
